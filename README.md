# IHW_4_OS

### Фролов Александр Сергеевич БПИ217

### Вариант 12

### Работа выполнялась на 8 баллов

Задача о гостинице – 1. 
В гостинице 30 номеров, гости гостиницы снимают номер на одни или несколько суток. Если в гостинице нет свободных номеров, гости не уходят, а устраиваются на рядом с гостиницей на скамейках и ждут, пока любой номеров не освободится. Создать приложение, моделирующее работу гостиницы. Сервер — это гостиница. Прибывающие гости могут порождаться отдельным клиентом. Другой клиент — это скамейки, образующие очередь ожидающих гостей.

### Задача на 4-5 баллов

##### Сервер (Server_hotel.c):

Сервер в данном коде представляет собой приложение гостиницы. Он прослушивает соединения от клиентов и обрабатывает их запросы на заселение и выселение. Вот описание работы сервера:

1) Создание UDP сокета:

Создается сокет с использованием функции socket() с параметрами AF_INET и SOCK_DGRAM.

2) Инициализация сервера:

• Структура server_addr инициализируется нулями и заполняется необходимыми параметрами, включая порт PORT и адрес INADDR_ANY.

3) Привязка сокета к адресу сервера:

• Сокет привязывается к адресу сервера с помощью функции bind(). Если привязка не удалась, сервер выводит сообщение об ошибке и завершает работу.

4) Ожидание клиентов:

• Сервер находится в бесконечном цикле while (1), ожидая запросов от клиентов.

5) Прием сообщения от клиента:

• Сервер использует функцию recvfrom() для приема сообщения от клиента. Прием происходит в буфер buffer.

6) Обработка запроса клиента:

• Сервер проверяет содержимое буфера buffer для определения типа запроса клиента.

7) Заселение клиента:

• Если запрос клиента соответствует "check-in" (заселение), сервер проверяет наличие свободных номеров (occupied_rooms < MAX_ROOMS).

• Если есть свободные номера, сервер отправляет подтверждение клиенту с помощью функции sendto(). Подтверждение содержит сообщение "OK".

• Количество занятых номеров occupied_rooms увеличивается, и сервер выводит сообщение о заселении клиента.

• Если нет свободных номеров, сервер отправляет отказ клиенту с помощью функции sendto(). Отказ содержит сообщение "No rooms available".

• Сервер выводит сообщение о отказе заселения клиента.

8) Выселение клиента:

• Если запрос клиента соответствует "check-out" (выселение), сервер освобождает номер.

• Количество занятых номеров occupied_rooms уменьшается, и сервер выводит сообщение об освобождении номера.

9) Зацикленность сервера:

• После обработки запроса сервер возвращается к шагу 5 и ожидает новых запросов от клиентов.

10) Завершение работы сервера:

• После выхода из бесконечного цикла сервер закрывает сокет и завершает работу.


##### Клиент (Client_guest.c):

Клиентское приложение представлено в виде множества потоков-клиентов, каждый из которых пытается заселиться в гостиницу. Вот описание работы клиента:

1) Создание UDP сокета:

Создается сокет с использованием функции socket() с параметрами AF_INET и SOCK_DGRAM.

2) Инициализация сервера:

Структура server_addr инициализируется нулями и заполняется необходимыми параметрами, включая IP-адрес SERVER_IP и порт PORT.

3) Отправка запроса на заселение:

Клиент создает буфер buffer и записывает в него сообщение "check-in", которое указывает на запрос на заселение.

4) Попытка заселения:

Клиент находится в бесконечном цикле while (1), пока не удалось заселиться.

Клиент проверяет доступность места в гостинице, блокируя мьютекс mutex.

Если есть свободные номера (occupied_rooms < MAX_OCCUPIED_ROOMS), клиент заселяется:

Количество занятых номеров occupied_rooms и количество клиентов в гостинице clients_in_hotel увеличиваются.

Клиент отправляет запрос на заселение с помощью функции sendto().

Клиент выводит сообщение о заселении и задерживается на некоторое случайное время для имитации пребывания в номере.

Клиент освобождает номер, уменьшая количество занятых номеров occupied_rooms и количество клиентов в гостинице 
clients_in_hotel.

Клиент отправляет сигнал другим клиентам, ожидающим в очереди, с помощью функции pthread_cond_signal().

Клиент выходит из цикла while (1).

Если нет свободных номеров, клиент освобождает мьютекс mutex и встает в очередь:

Клиент выводит сообщение о вступлении в очередь.

Клиент блокирует мьютекс mutex и ожидает освобождения номера с помощью функции pthread_cond_wait().

После получения сигнала от другого клиента, клиент разблокирует мьютекс mutex и повторяет попытку заселения.

5) Завершение работы клиента:

Клиент закрывает сокет и завершает поток.

6) Создание и запуск клиентских потоков:

В функции main() создается массив потоков threads для хранения идентификаторов потоков-клиентов.

Инициализируются мьютекс mutex и условная переменная cond.

Создается NUM_CLIENTS потоков-клиентов с помощью функции pthread_create(), которые выполняют функцию client_thread().

Главный поток ожидает завершения всех потоков-клиентов с помощью функции pthread_join().

Уничтожаются мьютекс mutex и условная переменная cond.

Выводится количество клиентов, заселившихся в гостиницу.


### Задача на 6-7 баллов: 


